<!DOCTYPE html>
<html>
  <head>
      <base target="_top">
      <meta charset="UTF-8">
      <title>Wreath Webform</title>
      <link rel="shortcut icon" href="#">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  </head>

  <style>
      body {
        max-width: 100%;
        /*background-color: #F7F6EF;*/
        background-color: rgb(245, 247, 238);
        font-family: Geneva, 'Lucida Grande', 'Lucida Sans Unicode', serif;
      }

      #yourip {
        text-align: center;
        margin-top: -24px;
        margin-bottom: 16px;
        font-size: small;
      }

      input[type=text]:not(.other_name) {
        border-radius: 3px;
        border: none;
        height: 18px;
      }

      /* Chrome, Safari, Edge, Opera */
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Firefox */
      input[type=number] {
        -moz-appearance: textfield;
      }

      .scout_name_select select, .add_item select {
        appearance: none;
        background-color: white;
        background-image: url(data:image/svg+xml,%3Csvg%20width%3D%2280px%22%20height%3D%2280px%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M5.70711%209.71069C5.31658%2010.1012%205.31658%2010.7344%205.70711%2011.1249L10.5993%2016.0123C11.3805%2016.7927%2012.6463%2016.7924%2013.4271%2016.0117L18.3174%2011.1213C18.708%2010.7308%2018.708%2010.0976%2018.3174%209.70708C17.9269%209.31655%2017.2937%209.31655%2016.9032%209.70708L12.7176%2013.8927C12.3271%2014.2833%2011.6939%2014.2832%2011.3034%2013.8927L7.12132%209.71069C6.7308%209.32016%206.09763%209.32016%205.70711%209.71069Z%22%20fill%3D%22%230F0F0F%22%2F%3E%0A%3C%2Fsvg%3E);
        background-repeat: no-repeat;
        background-position: right;
        background-size: 25px;
        min-width: 3.5em;
        height: 2em;
        padding: 2px;
        border-radius: 5px;
        padding: 1px;
        padding-left: 3px;
      }

      hr {
        border: 1px dotted blue;
      }

      .indent {
        margin-left: 1em;
      }

      .donation_label {
        margin-left: 10px;
        margin-right: -3px;
      }

      .wreath_item_select{
        /*
          width: 80%;
          min-width: 15.5em;
        */
          height: 2em;
        }

      .scout_name_select{
        background-color: khaki;
        border: transparent;
        min-width: 12em;
        height: 24px;
        border-radius: 5px;
      }

      .scout_name_select select {
        height: 24px;
        border-radius: 5px;
      }

      .container {
        max-width: 95%;
        margin: auto;
      }

      #webform_title{
        font-family: Geneva, 'Lucida Grande', 'Lucida Sans Unicode', serif;
      }

      .cust_payment>label {
        margin-right: -6px;
      }

      .cust_payment>input {
        margin-right: 10px;

      }

      .tab {
        overflow: hidden;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        padding: 0 2em 0 1em;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
        border-radius: 5px;
        z-index: 1000;

      }

      .tab_spaces {
        display: inline-block;
        margin-left: 40px;
      }

      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 28px;
        transition: 0.3s;
        font-size: 17px;
        font-family: Geneva, 'Lucida Grande', 'Lucida Sans Unicode', serif;
      }

      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #ddd;
      }

      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #ccc;
      }

      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 6px;
        /*animation: fadeEffect 1s;*/
      }

      .name_email_section {
        overflow: hidden;
        display: flex;
        justify-content: start;
        gap: 14px;
      }

      .tab_scoutname{
        display: flex;
        align-items: center;
      }

      .btn1, .btn2, .btn3 {
        background-color: #4CAF50;
        align-items: center;
        background-clip: padding-box;
        border: 1px solid transparent;
        border-radius: 8px;
        box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;
        box-sizing: border-box;
        color: #fff;
        cursor: pointer;
        display: inline-flex;
        font-size: 16px;
        justify-content: center;
        line-height: 1.25;
        padding: 5px;
        position: relative;
        margin-left: 5px;
      }

      .btn2 {
        background-color: #008CBA;
      }

      .btn1:hover, .btn2:hover, .btn3:hover {
        background-color: #00ace6;
        box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;
      }

      .btn1:active, .btn2:active, .btn3:active {
        background-color: #0086b3;
        box-shadow: rgba(0, 0, 0, .06) 0 2px 4px;
      }

      .btn3 {
        z-index: 1;
        font-size: 10px;
      }

      #totals {
        margin-top: 5px;
        margin-bottom: 3px;
      }

      .spacing1 {
        padding: 0 0 16px 0;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .tab_info {
        max-width: 60em;
        font-family: Geneva, 'Lucida Grande', 'Lucida Sans Unicode', serif;
        font-size: 16px;
      }

      .all_data_table{
        position: relative;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 12px;
        border-collapse: collapse;
        width: auto;
        border: 1px solid #ccc;
        box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
      }

      .local_orders{
        overflow-x: auto;
        max-width: 100%;
        scrollbar-width: thin;
        scrollbar-color: #888 #f1f1f1;
      }

      .all_data_table  caption {
        position: relative;
        z-index: 500;
      }

      .all_data_table > caption > h3 {
        margin-top: 0px;
        margin-bottom: 5px;
      }

      .all_data_table tr:nth-child(2n+1) {
        background-color: azure;
      }

       .table_item_left{
        border-left: 1px dashed lightgray;
        border-right: 1px dashed lightgray; 
        padding-left: 10px;
        padding-right: 5px;
       }

       #all_data_table > tbody > tr > td:nth-child(3){
         padding-left: 5px;
        }

      .all_data_table tr:hover {background-color: #ddd;}
      .all_data_table td:hover {background-color: orange;}

      .all_data_table td:hover .comment_div {
        background-color: white;
      }


      .all_data_table th {
        position: sticky;
        top: 0;
        z-index: 101;
        padding-top: 5px;
        padding-bottom: 5px;
        text-align: center;
        background-color: #75c0e0;
        color: white;
      }

      .all_data_table tr {
        text-align: center;
      }

      .all_data_table td {
        position: relative;
        text-align: center;

      }

      .gift_shipper_table {
        width: 100%;
      }

      .gift_shipper_table > tbody > tr > td {
        padding: 3px;
      }

      .gift_shipper_table th {
        padding-top: 20px;
        padding-bottom: 20px;
      }

      .gift_shipper_table > tbody > tr > td:nth-last-child(1) {
        max-width: 320px;
      }

      .gift_shipper_table > tbody > tr > td:nth-child(3) {
        max-width: 320px;
        border-left: 1px dashed lightgray;
        border-right: 1px dashed lightgray;      
      }

      .gift_shipper_table > tbody > tr > td:hover {
        background-color: orange;
      }

      .table_item_left {
        text-align: left !important;
        width: 250px;
      } 

      td:hover{
       overflow-x:visible;
       overflow-y: visible;
      }

      .table_timestamp {
        text-align: left !important;
        max-width: 200px;

      }

      .table_cell_note:hover {
        cursor: pointer;
      }

      tr.tfoot_wide_tr:hover td, tr.tfoot_wide_tr td:hover{
        background-color: #F7F6EF !important;
      }

      .table_tfoot {
        background-color:#F7F6EF;
      }

      .table_tfoot:hover {
        background-color: inherit;
      }

      .tfoot_div1{
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }

      .tfoot_div1:hover {
        background-color: inherit;
      }

      .local_orders_info, .gift_shipper_info {
        display: none;
      }


      .column4
      {
        display: "";
      } 

      .column5
      {
        display: "";
      } 
      .column6
      {
        display: "";
      } 
      .column7
      {
        display: "";
      } 
      .column8
      {
        display: "";
      } 
      .column9
      {
        display: "";
      } 
      .column10
      {
        display: "";
      } 
      .column11
      {
        display: "";
      } 
      .column12
      {
        display: "";
      } 
      .column13
      {
        display: "";
      } 
      .column14
      {
        display: "";
      } 
      .column15
      {
        display: "";
      } 
      .column16
      {
        display: "";
      } 
      .column17
      {
        display: "";
      } 
      .column18
      {
        display: "";
      } 
      .column19
      {
        display: "";
      } 
      .column20
      {
        display: "";
      } 


      .doorhangercolumn4
      {
        display: "";
      } 

      .doorhangercolumn5
      {
        display: "";
      } 
      .doorhangercolumn6
      {
        display: "";
      } 
      .doorhangercolumn7
      {
        display: "";
      } 
      .doorhangercolumn8
      {
        display: "";
      } 
      .doorhangercolumn9
      {
        display: "";
      } 
      .doorhangercolumn10
      {
        display: "";
      } 
      .doorhangercolumn11
      {
        display: "";
      } 
      .doorhangercolumn12
      {
        display: "";
      } 
      .doorhangercolumn13
      {
        display: "";
      } 
      .doorhangercolumn14
      {
        display: "";
      } 
      .doorhangercolumn15
      {
        display: "";
      } 
      .doorhangercolumn16
      {
        display: "";
      } 
      .doorhangercolumn17
      {
        display: "";
      } 
      .doorhangercolumn18
      {
        display: "";
      } 
      .doorhangercolumn19
      {
        display: "";
      } 
      .doorhangercolumn20
      {
        display: "";
      } 

      .hidden_row {
        display: none;
      }

      .disabled_arrow {
        color: lightgray;
        cursor: text !important;
      }

      .comment_div{
        position: absolute;
        top: 0;
        right: 0;
        width: 0px;
        height: 0px;
        border: 10px solid;
        border-width: 13px 0 0 13px;
        border-color: orange transparent transparent transparent;
      }

      .cust_info{
        display: flex;
        flex-flow: column;
        width: 30em;
        gap: 7px;
        padding: 0.5em 1em 0.5em 1em;
        margin-left: 3em;
        background: #ADD8E6;
        border-radius: 5px;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      }

      .cust_info_item {
        display: flex;
        flex-flow: row;
        align-items: center;
        gap: 8px;
      }

      .cust_info_item label {
        White-space: nowrap;
      }

      .section_titles {
        display: flex;
        flex-flow: column;
        padding: 0 0 0 0;
      }

      @keyframes fadeEffect {
        from {opacity: 0;}
        to {opacity: 1;}
      }

      .data_section{
        display: flex;
        flex-direction: column;
      }

      .add_item{
        display: flex;
        flex-flow: row nowrap;
        align-items: center;
        justify-content: start;
        gap: 13px;
        padding: 0.5em 1em 1em 0em;
      }

      .add_item_column {
        display: flex;
        position: relative;
        flex-flow: column;
        border-radius: 5px;
        padding: 1em 1em 1em 1em;
        background: #FF8C00;
        width: 40em;
        /*max-width: 36em;*/
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      }
      
      .wreath_line {
        display: flex;
        flex-flow: row nowrap;
        align-items: center;
        gap: 13px;

       }

       .wreath_info {
         width: 35em;
         padding: 1em 0 0 0;
       }

       .wreath_donation_amt{
          display: none;
        }

      .single_entry{
        display: flex;
        flex-flow: column;
        padding: 1px 0 0 0;
      }
      .header1 {
        padding: 1em 0 0 0;
        margin-bottom: -10px;
      }

      .add_item_svg:hover {
        color: #FF8C00;
        cursor: pointer;
      }

      .x_circle {
        position: absolute;
        right: 5px;
        top: 5px;
      }

      .x_circle:hover {
        color: white;
        cursor: pointer;
      }

      .single_entry_bottom {
        overflow: hidden;
        display: flex;
        position: sticky;
        bottom: 0;
        justify-content: space-between;
        align-items: center;
        width: 42em;
        padding: 0.5em 2em 0.5em 1em;
        background: #f1f1f160;
        border: 1px solid #ccc;
        border-radius: 5px;

      }

      .popup {
        max-width: 100%;
        max-height: 100%;
        position: fixed;
        z-index: 1101;
        left: 50%;
        top: 50%;
        border-radius: 8px;
        margin: auto;
        transform: translate(-50%, -50%);
        transition: opacity 400ms ease-in;
        background: #F7F6EF;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      }

      .popup2 {
        max-width: 100%;
        max-height: 100%;
        position: absolute;
        z-index: 1101;
        left: 50%;
        top: 50%;
        border-radius: 8px;
        margin: auto;
        transform: translate(-50%, -50%);
        transition: opacity 400ms ease-in;
        background: #F7F6EF;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      }

      .popup_overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1100;

        opacity: 0.4;
        background-color: rgba(0,0,0,0.5);
      }

      .popup_overlay2 {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1100;

        opacity: 0.4;
        background-color: rgba(0, 0, 0, 0.2);
      }

      .popup_content {
        margin: 10px;

      }

      .popup_button {
        position: absolute;
        top: -14px;
        right: -16px;
        background-color: teal;
        border: 1px solid transparent;
        border-radius: 8px;
        cursor: pointer;
        color: #fff;
        padding: 3px;
      }

      .clickable_span{
        color: blue;
      }

      .clickable_span:hover {
        cursor: pointer;

      }

      .show_info_link {
        display: none;
      }

      .all_data_div {
        display: none;
      }

      .loader {
        display: none;
        position: fixed;
        z-index: 1101;
        left: 50%;
        top: 50%;
        border-top: 13px solid darkorange;
        border-right: 13px solid seagreen;
        border-bottom: 13px solid darkorange;
        border-left: 13px solid seagreen;
        border-radius: 50%;
	      margin: auto;
        margin-left: -7vw;
        width: 70px;
        height: 70px;
        transform: translate(-50%, -50%);
        animation: spin 1.5s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      #cust_addr, #cust_note, #cust_email {
        flex-grow: 2;
      }

      .btn4 {
        margin-right: -10px;
        border-radius: 4px;
        border-width: 1px;
      }

      .avoidwrap {
        display: flex;
        flex-flow: row;
        gap: 10px;
        align-content: center;
        align-items: center;
      }

      .totals_class {
        border-top: 1px dashed;
      }

      tfoot tr {
        background-color: powderblue !important;
      }

      .single_entry_section_off{
        width: 100vw;
        height: 100vh;
      }
      .single_entry_off{
        position: relative;
        height: 40vh;
        width: 78vw;
      }

      .order_totals_ul {
        margin-top: 0px;
        margin-bottom: 5px;
      }
      
      .column_toggle {
        position: absolute;
        left: 0;
        top: 0;
      }

      .paging_div{
        position: absolute;
        right: 10px;
        top: -5px;
        display: flex;
        flex-direction: row;
        font-size: 16px;
        gap: 13px;
        z-index: 200;
        user-select: none;
        align-items: center;
      }

      .paging_div div {
        user-select: none;
      }

      .paging_div2{
        display: flex;
        flex-direction: row;
        font-size: 12px;
        gap: 13px;
        user-select: none;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
      }

      .paging_div2 div {
        user-select: none;
      }

      .paging_div3{
        margin-right: 1em;
      }

      .paging_div3 select {
        -webkit-appearance: none;
        background-color: #E3EEFC;
        font-family: Geneva, 'Lucida Grande', 'Lucida Sans Unicode', serif;
        color: darkslategray;
        border-radius: 4px;
        font-size: 14px;
        padding-left: 8px;
        padding-right: 8px;
        text-align-last:center;
        border: 1px gray solid;

      }

      table caption {
        position: relative;
      }

      .table_paging_button {
        cursor: pointer;
        font-size: 24px;
        margin-bottom: 2px;
      }

      .div_link{
        color: blue;
        cursor: pointer;
      }

      .all_data_info1{
        position: relative;
      }

      @media (min-width: 1080px) {
        .tab{
          width: 96%;
        }
      }

      @media (max-width: 800px)  {

        body {
          padding-bottom: 160px;
        }

        .container {
          max-width: 100%;
          margin: auto;

        }

        .popup {
          width: 70vw;
        }

        .cust_info_item {
          width: 99%;
        }

        #cust_addr, #cust_note, #cust_email {
          width: auto;
          max-width: 80%;
      }

        .wreath_info {
          width: 100%;
        }

        .wreath_line{
          flex-flow: row wrap;
        }

        .wreath_info{
          display: none;
        }

        .order_divs {
          display: flex;
          margin: 1em 0 1em 0;
          padding: 1em 1em 1em 1em;
          background-color: lightblue;
          border-radius: 5px;
          flex-direction: column;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
          width: 80vw;
        }

        .doorhanger_order_divs {
          display: flex;
          margin: 1em 0 1em 0;
          padding: 1em 1em 1em 1em;
          background-color: lightblue;
          border-radius: 5px;
          flex-direction: column;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
          width: 80vw;
        }

        #my_orders_section {
          font-size: 14px;
        }

        #email_address {
          width: auto;
        }

        .email_div {
          display: flex;
          flex-flow: row;
          align-items: center;
          width: 100%;
          gap: 8px;
          margin-top: -8px;
        }

        .order_divs:nth-child(2n+1){
          background-color: lightcyan;
        }

        .doorhanger_order_divs:nth-child(2n+1){
          background-color: lightcyan;
        }

        .all_data_div {
          display: inline-block;
        }

        .show_info_link {
          display: inline-block;
        }

        .all_data_table {
          display: none;
        }

        .local_orders_info, .gift_shipper_info {
          display: flex;
          margin-top: 5px;
          margin-bottom: 0px;
          font-weight: bold;
        }

        #cust_note {
          width: 80%;
        }

        .tab {
          width: 100%;
          padding: 0 0 0 0;
        }

        .tab_info {
          font-size: 15px;
        }

        .single_entry_bottom {
          width: 100%;
          padding: 0.25em 0 0.25em 0;
	        margin-bottom: 2em;

        }

        .cust_info{
          width: calc(100% - 10px);
          column-gap: 2px;
          row-gap: 5px;
          padding: 0.5em 0.5em 0.5em 0.5em;
          margin-left: 0px;
          background: #ADD8E6;
          border-radius: 5px;
          font-size: 14px;
        }

        .add_item{
          gap: 3px;
          padding: 0.5em 0 0.5em 0;
        }

        .add_item_column {
          padding: 0.5em 0.5em 0.5em 0.5em;
          max-width: 90%;
        }

        .add_item_svg {
          margin-left: -8px;
        }

        .wreath_line {
          gap: 4px 20px;
        }

        .wreath_info_small {
          display: flex;
          flex-flow: row;
          gap: 8px;
          margin-top: 3px;
        }
        .tab button {
          font-size: 15px;
          padding: 10px 8px;
        }

        .avoidwrap {
          display: flex;
          flex-flow: row;
          align-items: center;
        }

        .wreath_item_select{
          
          width: 80%;
          min-width: 15.5em;
          
        }

        .btn4 {
          margin-right: -8px;
        }

        .single_entry_off{
          width: 100%;
          height: 60vh;
        }

      }


  </style>
  <body>
    <div class="container" id="container">
      <center><h1 id="webform_title"></h1></center>
      <div id="yourip"></div>
      <div id="name_email_div" class="spacing1" >
        <div class="name_email_section" id="name_email_section">
          <span id="scoutname_span">
            <label for="scoutname">Scout Name: </label>
              <select name="scoutname" id="scoutname" class="scout_name_select" onchange="toggle_name(this)"></select>
          </span>
          <span id="display_other_name" style="display: none;">
            <label for="other_name">Enter Name: </label>
              <input id="other_name" type="text" class="other_name" name="other_name" onblur="container_click()">
          </span> 
        </div>
        <span id="name_email_div_dummy_span"></span>
        
        <div class="email_div" id="email_div">
          <label for="email_address" class="email_label">Your Email: </label>
          <input id="email_address" type="email" name="email_address" placeholder="required">
          <span class="clickable_span" onclick="show_email_info()">[info]</span>
        </div>
      </div>

      <div class="tab" id="tab">
        <div>
          <button id="enter_order_button" class="tablinks" onclick="openTab(event, 'single_entry_section')">Enter Order</button>
          <!--     <button class="tablinks" onclick="openTab(event, 'multi_order_section')">Multi Order</button> -->
          <button class="tablinks" onclick="openTab(event, 'my_orders_section')">My Orders</button>
          <button class="tablinks" onclick="openTab(event, 'info_section')">Info</button>
        </div>
        <div id="tab_scoutname" class="tab_scoutname">
        </div>

      </div>

      <div id="single_entry_section" class="tabcontent">
        <div id="single_entry_content">
          <p id="single_entry_info" class="tab_info"></p>
          <div class="section_titles">
            <span>Customer contact info:</span>
          </div>
          <div class="cust_info">
            <div class="cust_info_item">
              <label for="cust_name">Name: </label>
              <input id="cust_name" type="text" name="cust_name" placeholder="required">
            </div>

            <div class="cust_info_item">
              <label for="cust_addr">Address: </label>
              <input id="cust_addr" type="text" name="cust_addr" placeholder="optional">
              <button type="button" id="geo_loc" class="btn4" onclick="geo_loc()" name="geo_loc">GPS</button>
            </div>

            <div class="cust_info_item">
              <label for="cust_phone">Phone if known: </label>
              <input id="cust_phone" type="tel" name="cust_phone" style="width: 10em;" onInput="this.value = phoneFormat(this.value)" placeholder="optional">
            </div>

            <div class="cust_info_item">
              <label for="cust_email">Email address to get a receipt: </label>
              <input id="cust_email" type="text" name="cust_email" style="width: 10em;" placeholder="optional">
            </div>

            <div class="cust_info_item">
              <label for="cust_note">Add note to order? </label>
              <input id="cust_note" type="text" name="cust_note" placeholder="optional">
              <!-- 
              <button type="button" id="paid" class="btn4" onclick="paid_button()" name="paid">Paid?</button>
              -->
            </div>
            <div class="cust_payment">
              <span>Payment:  </span>
              <label for="cust_cash">Cash</label>
              <input type="checkbox" id="cust_cash" name="cust_cash" value="cust_cash" onchange="toggle_checkbox(this)">
              <label for="cust_check">Check</label>
              <input type="checkbox" id="cust_check" name="cust_check" value="cust_check" onchange="toggle_checkbox(this)">
              <label for="cust_venmo">Venmo</label>
              <input type="checkbox" id="cust_venmo" name="cust_venmo" value="cust_venmo" onchange="toggle_checkbox(this)">
              <label for="cust_unpaid">Unpaid</label>
              <input type="checkbox" id="cust_unpaid" name="cust_unpaid" value="cust_unpaid" onchange="toggle_checkbox(this)">
            </div>

          </div>

          <div class="single_entry">
              <span class="header1">Enter customer order:</span>
            <div class="single_entry">
              <div id="wreath_section" class="wreath_section"></div>
            </div>
            <div class="single_entry_bottom">
              <div id="single_entry_buttons" class="single_entry_buttons">
                <button type="button" id="clear_all" class="btn2" onclick="clear_data()" name="clear_data">Clear All</button>
                <button type="button" id="save_all" class="btn1" onclick="save_data()" name="Submit_data">Submit</button>
              </div>
              <div class="avoidwrap">
                <strong>Total: </strong> <span id="single_entry_total">$0</span>
              </div>
            </div>
          </div>
        </div>
        <div id="single_entry_section_off" class="" style="display: none;">
          <div id="single_entry_off" class="single_entry_off">
            <div id="popup2" class="popup2">
              <!--<button class="popup_button" onclick="toggle_modal()">Close</button>-->
              <div id="popup_content2" class="popup_content"> 
                <center>Order Entry is Off</center>
              </div>
            </div>
            <div id="popup_overlay2" class="popup_overlay2"></div>
          </div>
        </div>
      </div>
<!--
      <div id="multi_order_section" class="tabcontent">
        <p id="multi_order_info"></p>
      </div>
-->

      <div id="my_orders_section" class="tabcontent">
        <p id="my_orders_info" class="tab_info"></p>
        <div id="my_orders">
          <p id="totals"></p>
          <div class="render_orders_row">
            <span id="cached_timestamp"></span>
            <button type="button" id="show_all" class="btn3" onclick="render_orders('server')" name="clear_data">Refresh</button>
          </div>
            <p id="all_data_info1" class="all_data_info1"></p>
              <div id="local_orders" class="local_orders">

                <table id="all_data_table" class="all_data_table">
                  <caption id="all_data_table_caption">
                    <h3>Webform Orders - <a id="local_csv">[CSV]</a></h3>
                    <div class="column_toggle">
                      <input type="checkbox" id="column_toggle" name="column_toggle" onclick="checkbox_toggle(this)" checked>
                      <label for="column_toggle">Hide zero total columns</label>
                    </div>
                  </caption>
                  <thead id="thead_data_table"></thead>
                  <tbody id="tbody_data_table"></tbody>
                  <tfoot id="all_data_table_tfoot"></tfoot>
                </table>
                <p class="local_orders_info">Webform orders - 
                  <a id="local_csv2"> [CSV]</a>
                </p>

                <div id="all_data_div1" class="all_data_div">
                </div>
              </div>
              <br><br>
            <p id="doorhanger_info" class="all_data_info1"></p>
            <div id="doorhanger_orders" class="local_orders">
              <table id="doorhanger_table" class="all_data_table">
                <caption id="doorhanger_table_caption">
                  <h3>Doorhanger Orders - <a id="doorhanger_csv">[CSV]</a></h3>
                  <div class="column_toggle">
                    <input type="checkbox" id="doorhangercolumn_toggle" name="column_toggle" onclick="checkbox_toggle(this)" checked>
                    <label for="doorhangercolumn_toggle">Hide zero total columns</label>
                  </div>
                </caption>
                <thead id="thead_doorhanger_table"></thead>
                <tbody id="tbody_doorhanger_table"></tbody>
                <tfoot id="doorhanger_table_tfoot"></tfoot>
              </table>
              <p class="local_orders_info">Doorhanger orders - 
                <a id="doorhanger_csv2"> [CSV]</a>
              </p>
              <div id="doorhanger_div" class="all_data_div">
              </div>
            </div>
            <br><br>
            <p id="all_data_info2"></p>
            <div id="gift_shipper_orders">
              <table id="gift_shipper_table" class="all_data_table gift_shipper_table">
                <caption id="gift_shipper_table_caption"><h3>Gift Shipper Orders - <a id="shipper_csv">[CSV]</a></h3>
                </caption>
                <thead id="thead_gift_shipper"></thead>
                <tbody id="tbody_gift_shipper"></tbody>
                <tfoot id="gift_shipper_table_tfoot"></tfoot>
              </table>
              <p class="gift_shipper_info">Gift Shipper Orders:
                <a id="shipper_csv2"> [CSV]</a>
              </p>
              <div id="all_data_div2" class="all_data_div">
              </div>
            </div>
            <br><br>
        </div>
      </div>

      <div id="info_section" class="tabcontent">
        <p id="info_info" class="tab_info"></p>
      </div>

      <div id="popup" class="popup" style="display: none;">
        <button class="popup_button" onclick="toggle_modal()">Close</button>
        <div id="popup_content" class="popup_content">
        </div>
      </div>
      <div id="popup_overlay" class="popup_overlay" style="display: none;" onclick="toggle_modal()"></div>
      <div class="loader" id="loader"></div>
    </div>

  </body>

  <script>
    var setup_sheet_name = "Webstore Setup";
    var store_sheet_name = "Giftshipper Catalog";
    var orgs_sheet_name = "Webstore Orgs";
    var local_sheet_name = "Local Catalog";
    var webform_sheet_name = "Webform Setup";
    var giftshipper_sheet_name = "Gift Shipper";
    var webform_orders_sheet_name = "Webform";
    var doorhanger_orders_sheet_name = "Doorhanger";
    var all_data_sheet_name = "All orders";
    var collected_amount_column = 0;
    var remaining_to_collect_column = 0;
    var sheet_names_setup = [local_sheet_name, webform_sheet_name];
    var sheet_names_orders = [giftshipper_sheet_name, webform_orders_sheet_name, doorhanger_orders_sheet_name, all_data_sheet_name];
    var sheet_ranges = "A1:S600";
    var sheet_values = {};
    var order_data_values = {};
    var url_param_off = "yes";

    var form_data;
    var announcement, title, scoutname, description, email_instructions, info_panel, multi_cust_inst, gas_link, id, 
      url_params, url_name, url_email, tracking_sheet, webform_toggle;
    var local_catalog = [];
    var wreath_items = [];

    var wreath_list = '';
    var item_count = 2;
    var order_total = 0;
    var single_order = [];
    single_order[0] = [];
    var multi_order = [];

    var order = {};
    var local_orders = [];
    var doorhanger_orders = [];
    var gift_shipper_orders = [];
    var all_data_orders = [];

    var csvStr_local = "";
    var doorhanger_csvStr = "";
    var csvStr_ship = "";

    var ip_addr = "";


    var curr_tab;

    var table_len = {};
    var table_index = {};
    var table_page = {};
    var pager_html = {};

    var plus_circle = `
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
      </svg>
    `;

    var x_circle = `
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
          <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
      </svg>
      `;

    var add_single_wreath = `
      <div id="webform_item_MMM" class="add_item">
       <div id="add_item_MMM" class="add_item_svg" onclick="add_wreath_item(this, event)" title="add another"> ${plus_circle} </div>
       <div class="add_item_column">
          <div id="x_circle_MMM" class="x_circle" onclick="delete_wreath_item(this)" title="delete"> ${x_circle}</div>
          <div class="wreath_line">
            <div class="avoidwrap">
             <label for="wreath_name">Item:</label>
              <select id="wreath_item_MMM" class="wreath_item_select" name="wreath_item_MMM" onchange="wreath_item_change(this)">
                wreath_list
              </select>
              <label for="wreath_donation_MMM" id="wreath_donation_label_MMM" class="donation_label" style="display:none;">Amount</label>
              <input id="wreath_donation_input_MMM" type="text" inputmode="decimal" name="wreath_donation_MMM" style="width: 3em; display:none;" 
                onInput="this.value = donation_amt(this.value)" onblur="donation_amt_blur(this)" placeholder="$">
            </div>

            <div class="avoidwrap">

              <span id="wreath_item_span_MMM" class="avoidwrap">
                <label for="wreath_amt">Quantity:</label>
                <select id="wreath_amt_MMM" name="wreath_amt_MMM" onchange="wreath_amount_change(this)">
                  <option value="0" selected>0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                </select>
              
                <div id="wreath_price_MMM" class="avoidwrap">nnn</div>
                <div id="wreath_total_MMM" class="avoidwrap">Total: $0</div>
              </span>
            </div>
          </div>
        <div id="wreath_info_MMM" class="wreath_info">descr</div>
        <div id="wreath_info_small_MMM" class="wreath_info_small">
          <span id="info_click_MMM" class="clickable_span show_info_link" onclick="show_info(this)">[Info]</span>
          <span id="photo_click_MMM" style="" class="clickable_span" onclick="show_photo(this)">[Photo]</span>
        </div>
      </div>

    `;

    document.getElementById("single_entry_content").style.display="none";

    document.addEventListener('DOMContentLoaded', function() {
      var queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      if (urlParams.get("id1") == undefined){
        document.getElementById("container").style.display = "none";
      }

      if ((urlParams.get("id1"))){
          var scoutname_elem = document.getElementById('scoutname');
          var scout_email = document.getElementById('email_address');
          var other_name = document.getElementById('other_name');
          url_params = urlParams.get("email");
          id=urlParams.get("id1").replace("/", "");
          url_name = urlParams.get("scoutname") || "";
          url_name != "" ? url_name = url_name.replace(/[\.\_\-]/g, " ")
            .toLowerCase().replace(/(^\w{1})|(\s{1}\w{1})/g, match => match.toUpperCase()) : null;
          url_email = urlParams.get("email") || "";

          document.getElementById("column_toggle").checked = true;

          if (url_email != "") {
            var emailsArray3 = url_email.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
            if (emailsArray3 == null || emailsArray3.length == 0) {
              url_email = "";
            }
            else {
              scout_email.disabled = true;
            }
          }

          urlParams.get("scoutname") ? (scoutname_elem.disabled = true, other_name.disabled = true) : null;
        }

        if (urlParams.get("off")) {
          url_param_off = urlParams.get("off") || "yes"; //when urlParam off = no then override the off setting
        }

      var range_of_sheets = "";
      sheet_names_setup.forEach((item, i) => {
        range_of_sheets += "&ranges=" + item + "!" + sheet_ranges;
      });

      fetch_spreadsheet(
          urlParams.get("id1").replace("/", ""),
          urlParams.get("id2").replace("/", ""),
          range_of_sheets
        ).then(r => {
          //console.log(r.sheets);
          extract_values(r, "setup"); //extracts a row:column array of values of each sheet and populates a global object
          
          populate_variables(sheet_values[webform_sheet_name].slice(1));
          build_page(sheet_values[webform_sheet_name].slice(1));
          get_catalog(sheet_values[local_sheet_name].slice(1));
          observer.observe(document.querySelector("#name_email_div_dummy_span"));
	      });

      getip().then(ip => {
        document.getElementById("yourip").innerText = "Your IP: " + ip;
        ip_addr = ip;
      });

        
      }, false); 

    const observer = new IntersectionObserver((entries) => {
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
       entries.forEach(entry => {
        if (!entry.isIntersecting && vw > 540) {
            // when element is out of view move it
            document.getElementById("tab_scoutname").append(document.getElementById("scoutname_span"));

          }
          else {
            //when element comes back, return it
            if (vw > 540) {
              document.getElementById("name_email_section").insertBefore(document.getElementById("scoutname_span"), document.getElementById("name_email_section").firstChild);
            }
          }
        });
      }, {
        threshold: 0 // This ensures the callback is triggered as soon as any part of the element is out of view
        });

        /*
    async function fetch_spreadsheet(sheet_ID, api_key, range_of_sheets) {
        //more info about the link and options: https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/get
	      const response = await fetch("https://sheets.googleapis.com/v4/spreadsheets/" + sheet_ID 
          + "?includeGridData=true" + range_of_sheets + "&key=" + api_key);
	      const data = await response.json();
	      return data;
	    } 
        */

    async function fetch_spreadsheet(sheet_ID, api_key, range_of_sheets) {
      try {
          const response = await fetch("https://sheets.googleapis.com/v4/spreadsheets/" + sheet_ID 
              + "?includeGridData=true" + range_of_sheets + "&key=" + api_key);
          
          // Check if the response is not ok (status code not in the range 200-299)
          if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const data = await response.json();
          return data;
      } catch (error) {
          console.error("Error fetching spreadsheet:", error);
          var popup_elem = document.getElementById("popup_content");
          popup_elem.innerHTML = "An error occured while fetching from the server <br> <br>" + error;
          toggle_modal();
      }
    }


    function extract_values(r, type){
      var sheet_interesting_values;
      var row_in_string = "";

      r.sheets.forEach((item, i) => {
          sheet_interesting_values = [];
          //console.log(item.properties.title);
          item.data[0].rowData.forEach((item2, i2) => {
            var row_values = [];

            item2.values.forEach((item3, i3) => {
              if (item3.formattedValue) {
                row_values.push(item3.formattedValue);
              }
              else {
                row_values.push("");
              }
              
              //console.log(item3.effectiveValue.stringValue);
              //sheet_interesting_values[i2][i3] = item3.effectiveValue.stringValue;
            });
            //console.log(row_values);
            row_in_string = JSON.stringify(row_values).replace(/[\[\]\,\"]/g,''); //convert last row array to string

            if (row_in_string.length > 0 ) {
              sheet_interesting_values.push(row_values);
            }
          });
          if (type=="order_data"){
          order_data_values[item.properties.title] = sheet_interesting_values;
          }
          else {
            sheet_values[item.properties.title] = sheet_interesting_values;

          }

        }); 
    }

    function get_catalog(local_catalog_data){
      if (webform_toggle == "no") {return;}
        local_catalog = [...local_catalog_data];
        //append a donation item to the catalog
        local_catalog.push(["yes", "Donation", "Use this item to take a donation", "$0", "", ""]);
        local_catalog.forEach((item, i) => {
          item[0] == "yes" ? (wreath_list += '<option value="'+ i + '">' + item[1] + '</option>',
                wreath_items.push([item[1], item[3], item[2], item[4]]))
              : null;
        });
        document.getElementById("wreath_section").insertAdjacentHTML('beforeend',
          add_single_wreath.replace(/MMM/g, "1").replace(/wreath_list/g, wreath_list)
          .replace(/nnn/g, wreath_items[0][1]).replace(/descr/g, wreath_items[0][2]));

        /*
        setTimeout(function(){
        // This hides the address bar:
          window.scrollTo(0, 25);
        }, 100);
        */

        init_input_fields();

    }

    function delete_wreath_item(elem){
      var MMM = elem.id.split("_")[2];
      var add_item_elem = document.getElementById(`webform_item_${MMM}`);
      var webform_items_list = [];
      webform_items_list = document.getElementsByClassName("add_item");
      if (webform_items_list.length == 1) {
        document.getElementById("wreath_section").innerHTML =
          add_single_wreath.replace(/MMM/g, "1").replace(/wreath_list/g, wreath_list)
          .replace(/nnn/g, wreath_items[0][1]).replace(/descr/g, wreath_items[0][2]);
      }
      else {
        add_item_elem.remove();
      }

      single_order_data();
      single_order_total();

      var add_item_list = document.getElementsByClassName("add_item");
      var last_item = add_item_list[add_item_list.length-1].id;
      var last_item_visibility = document.getElementById(`add_item_${last_item.split('_')[2]}`).style.visibility;
      if (last_item_visibility == "hidden") {
        document.getElementById(`add_item_${last_item.split('_')[2]}`).style.visibility = "visible";
      }
    }

    function single_order_data(){
      var wreath_line_list = document.getElementsByClassName("wreath_line");
      var new_single_order_list = [];
      Array.from(wreath_line_list).forEach((item, index) => {
        var wreath_selector = item.querySelector('.wreath_item_select');
        var wreath_selector_quantity = item.querySelector("[id*='wreath_amt']");
        var wreath_selector_price = item.querySelector("[id*='wreath_price']");
        
        var wreath_selector_value = wreath_selector.value;
        var wreath_selector_option = wreath_selector.options[wreath_selector.selectedIndex].text;
        var wreath_quantity = wreath_selector_quantity.value;
        var wreath_price = wreath_selector_price.innerText.replace("$", "");

        /*
        if (wreath_selector_option == "Donation") {
          wreath_price = (item.querySelector("[id*='wreath_donation_input']")).value.replace("$", "");
          wreath_quantity = (1).toString();
        }
        */

        if (new_single_order_list[Number(wreath_selector_value)]) { //that's if we have multiples of the same item in the order
          if (wreath_selector_option == "Donation") {
            wreath_price =  (Number(new_single_order_list[Number(wreath_selector_value)][2]) + Number((item.querySelector("[id*='wreath_donation_input']")).value.replace("$", ""))).toString();
            wreath_quantity = (1).toString();
          }
          else {
            wreath_quantity = (Number(new_single_order_list[Number(wreath_selector_value)][1]) + Number(wreath_quantity)).toString();
            //wreath_price = (Number(new_single_order_list[Number(wreath_selector_value)][2]) + Number(wreath_price)).toString();
          }
        }
        else {
          if (wreath_selector_option == "Donation") {
            wreath_price = (item.querySelector("[id*='wreath_donation_input']")).value.replace("$", "");
            wreath_quantity = (1).toString();
          }
        }
          new_single_order_list[Number(wreath_selector_value)] = [wreath_selector_value, wreath_quantity,  wreath_price, wreath_selector_option];

      });

      single_order = [];
      single_order = [...new_single_order_list];
    }

    function add_wreath_item(elem, event){
      event.stopPropagation();
      var MMM = elem.id.split("_")[2];

      document.getElementById("wreath_section").insertAdjacentHTML('beforeend',
        add_single_wreath.replace(/MMM/g, item_count++).replace(/wreath_list/g, wreath_list)
        .replace(/nnn/g, wreath_items[0][1]).replace(/descr/g, wreath_items[0][2]));

      document.getElementById("add_item_"+MMM).style.visibility = 'hidden';
      window.scrollTo({ left: 0, top: document.body.scrollHeight, behavior: "smooth" })
    }

    function populate_variables(setup_data){
      var popup_elem = document.getElementById("popup_content");
      var cached_announcement = "";
      
      localStorage.getItem('cached_announcement') ? cached_announcement = localStorage.getItem('cached_announcement') : null;

      webform_toggle = setup_data[0][0] || "";
      announcement = setup_data[0][1] || "";
      title = setup_data[0][2] || "";
      scoutname = setup_data[0][3] || "";
      description = setup_data[0][4] || "";
      email_instructions = setup_data[0][5] || "";
      info_panel = setup_data[0][6] || "";
      multi_cust_inst = setup_data[0][7] || "";
      my_orders_panel = setup_data[0][8] || "";
      gas_link = setup_data[0][9] || "";
      tracking_sheet = setup_data[0][10] || "";

      if (webform_toggle == "no" && url_param_off == "no"){
        webform_toggle = "yes";
      }
      
      if (announcement != "" && hashCode(announcement) != cached_announcement && webform_toggle != "no"){
        popup_elem.innerHTML = "<strong>Announcement!</strong><br><br>" + announcement;
        localStorage.setItem('cached_announcement', hashCode(announcement));
        toggle_modal();
      }

     //announcement == "no" ? (popup_elem.innerHTML = "The wreath sale is over!", toggle_modal()) : null;
      JSON.parse(localStorage.getItem('cached_orders')) ? local_orders = JSON.parse(localStorage.getItem('cached_orders')) : local_orders = [];

    }

    function hashCode(str) {
      return str.split('').reduce((prevHash, currVal) =>
        (((prevHash << 5) - prevHash) + currVal.charCodeAt(0))|0, 0);
    }

    function build_page(setup_data){
      if (webform_toggle == "no") {
          document.getElementById("single_entry_section_off").style.display="";
        }
        else {
          document.getElementById("single_entry_content").style.display="";

        }
      document.getElementById("loader").style.display = "none";
      document.getElementById("single_entry_buttons").style.visibility="";
      document.getElementById('webform_title').innerHTML = title;
      populate_scoutnames();
      document.getElementById('single_entry_info').innerHTML = description;
      //document.getElementById('multi_order_info').innerHTML = multi_cust_inst;
      document.getElementById('my_orders_info').innerHTML = my_orders_panel;
      document.getElementById('info_info').innerHTML = info_panel;
      document.getElementById('email_address').setAttribute('title', email_instructions);

      document.getElementById("enter_order_button").click();

    }

    function send_backend(){
      var timestamp = new Date();
      var curr_timestamp = timestamp.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' });

      fetch(gas_link,
      {
        redirect: "follow",
        method: 'POST',
        headers: {
          'Accept': 'text/plain',
          'Content-Type': 'text/plain',
          },
        body: JSON.stringify(order)
      })
      .then((response) => {
        if (response.status >= 200 && response.status <= 299) {
          return response.json();
        } else {

          throw Error(response.statusText);
        }
      }).then((response) => {
        var popup_elem = document.getElementById("popup_content");
        if (response.status == "SUCCESS") {
          popup_elem.innerHTML = "Success! Your order was sent.";
          //console.log(response.status);
        }
         else {
          popup_elem.innerHTML = "Submit Error!<br><br>" + response.status;
        }
        document.getElementById("loader").style.display = "none";
        document.getElementById("single_entry_buttons").style.visibility="";
        toggle_modal();
        clear_data();
      }).catch((error) =>{
        var popup_elem = document.getElementById("popup_content");
        document.getElementById("loader").style.display = "none";
        document.getElementById("single_entry_buttons").style.visibility="";
        popup_elem.innerHTML = "An error occured while sending to the server <br> <br>" + error;
        toggle_modal();
      });
    }

    function openTab(event, tab_name){
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tab_name).style.display = "block";
      event.currentTarget.className += " active";
      curr_tab = tab_name;
      tab_name == "my_orders_section" ? render_orders('cached') : null;
    }

    function container_click(){
      var other_name_elem = document.getElementById('other_name');
      var scoutname_elem = document.getElementById('scoutname');
      var scoutname = document.getElementById('scoutname').value;
      var other_name = document.getElementById("other_name").value;

      scoutname_elem.value == "Other" && other_name_elem.value != "" && curr_tab == "my_orders_section" ?
        show_orders() : null;

      scoutname == "Other" && other_name != "" ? (other_name = other_name.replace(/[\.\_\-]/g, " ")
          .toLowerCase().replace(/(^\w{1})|(\s{1}\w{1})/g, match => match.toUpperCase()),
          document.getElementById("other_name").value = other_name): null;
    }

    function populate_scoutnames(){
      var scoutname_elem = document.getElementById('scoutname');
      var scout_email = document.getElementById('email_address');
      var other_name = document.getElementById('other_name');
      var other_name_elem = document.getElementById("display_other_name");
      var name_match = "";
      scoutname_elem.innerHTML = "";
      scoutname_elem[scoutname_elem.length] = new Option("", "");
      scoutname = scoutname.replace(/, /g, ',') + ",Other";
      scoutname.split(',').forEach((item, i) => {
        scoutname_elem[scoutname_elem.length] = new Option(item, item);
        item.includes(url_name) && url_name != "" ? name_match = item : null;
      });

      url_email != "" ? scout_email.value = url_email : null;
      if (url_name != "") {
        //if (scoutname.includes(url_name)) {
        if(name_match != ""){
          scoutname_elem.value = name_match;
        }
        else {
          scoutname_elem.value = "Other";
          other_name_elem.style.display = "";
          other_name.value = url_name;
        }
      }
    }

    function toggle_name(elem){
      var other_name_elem = document.getElementById('display_other_name');
      var scoutname_elem = document.getElementById('scoutname');
      var tbody_data_table = document.getElementById("tbody_data_table");
      var all_data_div1 = document.getElementById("all_data_div1");
      var all_data_div2 = document.getElementById("all_data_div2");
      var my_orders = document.getElementById("my_orders");

      reset_columns(["column", "doorhangercolumn"]);

      scoutname_elem.value == "Other" ? other_name_elem.style.display = "" :
          (other_name_elem.style.display = "none", document.getElementById("other_name").value="");
      curr_tab == "my_orders_section" ? render_orders("cached") : null;
    //  scoutname_elem.value == "Other" && curr_tab == "my_orders_section" ?
    //      (tbody_data_table.innerHTML = "", tbody_gift_shipper.innerHTML="", all_data_div1.innerHTML = "", 
    //        all_data_div2.innerHTML ="", my_orders.style.display = "none") : null;

    }

    function wreath_amount_change(elem){
      var wreath_index = document.getElementById("wreath_item_"+elem.id.split("_")[2]).value;
      var MMM = elem.id.split("_")[2];
      document.getElementById("wreath_total_" + MMM).innerHTML = "Total: $" +
        Number(document.getElementById("wreath_amt_" + MMM).value) * Number(local_catalog[wreath_index][3].split("$")[1]);

      Number(document.getElementById("wreath_amt_" + MMM).value) > 0 ?
      (single_order[Number(MMM)] = [wreath_index, document.getElementById("wreath_amt_" + MMM).value,
          local_catalog[wreath_index][3].split("$")[1], local_catalog[wreath_index][1]]) : null;

      Number(document.getElementById("wreath_amt_" + MMM).value) == 0 ?
        single_order[Number(MMM)] = [] : null;

      single_order_data();
      single_order_total();
    }

    function wreath_item_change(elem){
      var wreath_index = document.getElementById("wreath_item_"+elem.id.split("_")[2]).value;
      //console.log(local_catalog[wreath_index][1]);
      var MMM = elem.id.split("_")[2];
      document.getElementById("wreath_amt_" + elem.id.split("_")[2]).value = 0;
      document.getElementById("wreath_price_"+MMM).innerHTML = local_catalog[wreath_index][3];
      document.getElementById("wreath_total_" + MMM).innerHTML = "Total: $0";
      document.getElementById("wreath_info_" + MMM).innerHTML = local_catalog[wreath_index][2];

      if (local_catalog[wreath_index][1] == "Donation"){
        document.getElementById("wreath_item_span_" + MMM).style.display = "none";
        document.getElementById("photo_click_" + MMM).style.display = "none";
        document.getElementById("wreath_donation_label_" + MMM).style.display = "";
        document.getElementById("wreath_donation_input_" + MMM).style.display = "";
        document.getElementById("wreath_item_" + MMM).style.minWidth = "6em";
        document.getElementById("wreath_item_" + MMM).style.width = "10em";
      }
      else {
        document.getElementById("wreath_item_span_" + MMM).style.display = "";
        document.getElementById("photo_click_" + MMM).style.display = "";
        document.getElementById("wreath_donation_label_" + MMM).style.display = "none";
        document.getElementById("wreath_donation_input_" + MMM).style.display = "none";
        document.getElementById("wreath_item_" + MMM).style.minWidth = "15.5em";
        //document.getElementById("wreath_item_" + MMM).style.width = "10em";
      }

      single_order[Number(MMM)] = [];
      single_order_data();
      single_order_total();
    }

    function single_order_total(){
      order_total = 0;
      single_order.forEach((item, i) => {
        item ? order_total += Number(item[1]) * Number(item[2]) : null;
      });
      document.getElementById("single_entry_total").innerHTML = "$" + order_total;
    }

    function toggle_checkbox(elem){
      var cust_cash =  document.getElementById("cust_cash");
      var cust_check =  document.getElementById("cust_check");
      var cust_venmo =  document.getElementById("cust_venmo");
      var cust_unpaid =  document.getElementById("cust_unpaid");

      if (elem == cust_unpaid && cust_unpaid.checked){
        cust_cash.checked = false;
        cust_check.checked = false;
        cust_venmo.checked = false;
      }

      if (cust_cash.checked || cust_check.checked || cust_venmo.checked){
        cust_unpaid.checked = false;
      }
    }

    function save_data(){
      var popup_elem = document.getElementById("popup_content");
      var scoutname = document.getElementById('scoutname').value;
      var other_name = document.getElementById("other_name").value;
      var cust_name = document.getElementById("cust_name").value;
      var cust_email = document.getElementById("cust_email").value;
      var cust_phone = document.getElementById("cust_phone").value;
      var cust_addr = document.getElementById("cust_addr").value;
      var email_address = document.getElementById("email_address").value;
      var cust_note = document.getElementById("cust_note").value;
      var error_msg = "";
      var cust_cash =  document.getElementById("cust_cash").checked;
      var cust_check =  document.getElementById("cust_check").checked;
      var cust_venmo =  document.getElementById("cust_venmo").checked;
      var cust_unpaid =  document.getElementById("cust_unpaid").checked;
      var cust_payment = "";

      var timestamp = new Date();
      var curr_timestamp = timestamp.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' });

      if (cust_addr.split("GPS: ")[1]) {
        var coord = cust_addr.split("GPS: ")[1];
        var lat = coord.split(", ")[0];
        var long = coord.split(", ")[1];
        var map_link = "<a href='#link' target='_blank'>GPS: #text</a>";
        cust_addr = map_link.replace(/#link/g, "http://maps.google.com/maps?q="+lat+","+long).replace(/#text/g, lat+", "+long);
      }

      scoutname == "Other" && other_name != "" ? (other_name = other_name.replace(/[\.\_\-]/g, " ")
          .toLowerCase().replace(/(^\w{1})|(\s{1}\w{1})/g, match => match.toUpperCase()),
          document.getElementById("other_name").value = other_name): null;

      scoutname == "" ? error_msg += "The scout name cannot be blank!<br>" : null;
      scoutname == "Other" && other_name == "" ? error_msg += "The name field cannot be blank!<br>" : null;
      email_address == "" ? error_msg += "Your email address cannot be left blank! <br>" : null;

      if (email_address !="") {
        var emailsArray1 = email_address.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
        if (emailsArray1 == null || emailsArray1.length == 0) {
          error_msg += "Your email address is not valid. Please fix before submitting! <br>";
        }
      }

      if (cust_email !="") {
        var emailsArray2 = cust_email.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
        if (emailsArray2 == null || emailsArray2.length == 0) {
          error_msg += "Customer email address is not valid. Please fix before submitting! <br>";
        }
      }

      cust_name == "" ? error_msg += "The customer name cannot be blank!<br>" : null;
      error_msg == "" && order_total == 0 ? error_msg = "The total cannot be zero!" : null;

      error_msg != "" ? (popup_elem.innerHTML = error_msg, toggle_modal()) : null;

      if (error_msg == "") {
        var cust_contact1 = cust_name;
        var cust_contact2 = "";
        cust_addr == "" ? cust_contact2 += " - Address: not provided": cust_contact2 += " - Address: " + cust_addr;
        cust_contact1 += cust_contact2;
        cust_email == "" ? null : cust_contact1 += ". Email: " + cust_email;
        cust_phone == "" ? null : cust_contact1 += ". Phone: " + cust_phone;
        cust_cash ? cust_payment += " Cash" : null;
        cust_check ? cust_payment += " Check" : null;
        cust_venmo ? cust_payment += " Venmo" : null;
        cust_unpaid ? cust_payment += " Unpaid" : null;
        cust_cash || cust_check || cust_venmo || cust_unpaid ? cust_contact1 += " <br>**Payment:" + cust_payment : cust_contact1 += ".";

        var log_order = [];

        //remove empty slots (gaps) from the single_order array
        for (let i=0; i<single_order.length; i++){
          single_order[i] == null || single_order[i] == [] ? single_order[i] = [] : null;
        }

        single_order.forEach((item, i) => {
          if (item.length > 0) {
            if (item[3] == "Donation") {
              //take off the dolllar sign if any exists or set to zero
              log_order[Number(item[0])] ? log_order[Number(item[0])] = Number(log_order[Number(item[0])].replace(/\$/gi, "")) 
                : log_order[Number(item[0])] = 0;
              //add up multiple in the same order
              Number(item[1]) > 0 ? (log_order[Number(item[0])] += Number(item[2])) 
                || (log_order[Number(item[0])] = Number(item[2])) : null;
              //append dollar sign
              log_order[Number(item[0])] = "$" + log_order[Number(item[0])];
            }
            else {
              Number(item[1]) > 0 ? (log_order[Number(item[0])] += Number(item[1])) || (log_order[Number(item[0])] = Number(item[1])) : null;
            }
          }
        });

        var name = "";
        log_order.forEach((item, i) => {
          log_order[i] =log_order[i].toString();
        });

        //the following appends the ip address to log_order
        log_order[local_catalog.length] = ip_addr;

        scoutname == "Other" ? name = other_name : name = scoutname;

        log_order.unshift("$"+order_total);
        log_order.unshift(cust_note);
        //log_order.unshift(cust_contact2);
        log_order.unshift(cust_contact1);
        log_order.unshift(name);
        log_order.unshift(curr_timestamp);

        order["scoutname"] = scoutname;
        order["other_name"] = other_name;
        order['name'] = name;
        order["cust_name"] = cust_name;
        order["cust_email"] = cust_email;
        order["cust_phone"] = cust_phone;
        order["cust_addr"] = cust_addr;
        order['cust_contact'] = cust_contact1;
        order["email_address"] = email_address;
        order["order_total"] = "$" + order_total;
        order["single_order"] = single_order;
        order["log_order"] = log_order;
        order["id"] = id;
        order["curr_timestamp"] = curr_timestamp;
        order["cust_note"] = cust_note;
        order["tracking_sheet"] = tracking_sheet;
        order["hostname"] = window.location.hostname;
        order["ip_addr"] = ip_addr;

        /*
        single_order.forEach((item, i) => {
          item.length > 0 ? local_orders.push(single_order) : null;
        });
        */
        local_orders.push(log_order);
        localStorage.setItem('cached_orders', JSON.stringify(local_orders));
        //localStorage.setItem('cached_timestamp', JSON.stringify(curr_timestamp));
        document.getElementById("single_entry_buttons").style.visibility="hidden";
        document.getElementById("loader").style.display = "block";
        send_backend();
      }
    }

    function clear_data(){
      document.getElementById("wreath_section").innerHTML =
        add_single_wreath.replace(/MMM/g, "1").replace(/wreath_list/g, wreath_list)
          .replace(/nnn/g, wreath_items[0][1]).replace(/descr/g, wreath_items[0][2]);
      init_input_fields();
      single_order = [];
      single_order[0] = [];
      single_order_data();
      single_order_total();
    }

    function toggle_modal(){
      var modal = document.getElementById("popup");
      var overlay = document.getElementById("popup_overlay");

      modal.style.display = modal.style.display == 'none' ? '' : 'none';
      overlay.style.display = overlay.style.display == 'none' ? '' : 'none';

    }

    function init_input_fields(){
      document.getElementById("cust_cash").checked = false;
      document.getElementById("cust_check").checked = false;
      document.getElementById("cust_venmo").checked = false;
      document.getElementById("cust_unpaid").checked = false;

      document.querySelectorAll('input').forEach( input => {
        if(input.id == "email_address" || input.id == "other_name") return;
        input.value = "";
      });



    }

    function show_info(elem){
      var popup_elem = document.getElementById("popup_content");
      var MMM = elem.id.split("_")[2];
      var wreath_index = document.getElementById("wreath_item_"+MMM).value;

      popup_elem.innerHTML = local_catalog[wreath_index][2];
      toggle_modal();
    }

    function show_photo(elem){
      var popup_elem = document.getElementById("popup_content");
      var MMM = elem.id.split("_")[2];
      var wreath_index = document.getElementById("wreath_item_"+MMM).value;
      var wreath_image_link = local_catalog[wreath_index][4];
      var width = document.body.clientWidth;

      width > 800 ? width = Math.round(width / 4) : width = Math.round(width * 0.7);

      //width = Math.round(width / 4);

      var url_split = wreath_image_link.split(/=[ws]/);

      var wreath_image_html = "<img id='' src='" + url_split[0] + "=w" + width + "-no?authuser=0 alt=' ' />";
      popup_elem.innerHTML = wreath_image_html;
      toggle_modal();

    }

    function show_email_info(){
      var popup_elem = document.getElementById("popup_content");
      popup_elem.innerHTML = email_instructions;
      toggle_modal();
    }

    function fetch_orders(){
      var queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      var timestamp = new Date();
      var curr_timestamp = timestamp.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' });

      var range_of_sheets = "";
      sheet_names_orders.forEach((item, i) => {
        range_of_sheets += "&ranges=" + item + "!" + sheet_ranges;
      });

      fetch_spreadsheet(
          tracking_sheet,
          urlParams.get("id2").replace("/", ""),
          range_of_sheets
        ).then(r => {
          //console.log(r.sheets);
          extract_values(r, "order_data"); //extracts a row:column array of values of each sheet and populates global object
          
          //console.log(order_data_values);
          local_orders = order_data_values[webform_orders_sheet_name];
          doorhanger_orders = order_data_values[doorhanger_orders_sheet_name];
          all_data_orders = order_data_values[all_data_sheet_name];
          localStorage.setItem('cached_orders', JSON.stringify(local_orders));
          localStorage.setItem('doorhanger_orders', JSON.stringify(doorhanger_orders));
          localStorage.setItem('all_data_orders', JSON.stringify(all_data_orders));
          localStorage.setItem('cached_timestamp', curr_timestamp);
          fetch_gift_shipper(order_data_values[giftshipper_sheet_name]);
	      });
    }

    function fetch_gift_shipper(gift_shipper_orders){
        localStorage.setItem('cached_gift_shipper', JSON.stringify(gift_shipper_orders));
        show_orders();
    }

    function render_orders(order_source){
      var popup_elem = document.getElementById("popup_content");
      var scoutname = document.getElementById('scoutname').value;
      var other_name = document.getElementById("other_name").value;
      var my_orders = document.getElementById("my_orders");
      var name = "";
      var today_date = new Date();
      scoutname == "Other" ? name = other_name : name = scoutname;

      if (scoutname == "") {
        popup_elem.innerHTML = "Select a name above to get data!";
        my_orders.style.display = "none";
        toggle_modal();
        return;
      }
      else if (scoutname == "Other" && other_name == "") {
        popup_elem.innerHTML = "Enter any name above and then click anywhere in the document to see orders";
        //my_orders.style.display = "none";
        toggle_modal();
        return;
      }

      if (order_source == "cached"){
        if (localStorage.getItem('cached_orders') && (Date.parse(today_date) - Date.parse(localStorage.getItem('cached_timestamp')) < 86400000)) {
          show_orders();
        }
        else {
          fetch_orders();
        }
      }
      else {
        fetch_orders();
      }

    }

    function show_orders(){
      var scoutname = document.getElementById('scoutname').value;
      var other_name = document.getElementById("other_name").value;
      var cached_timestamp = document.getElementById('cached_timestamp');
      var all_data_info1 = document.getElementById("all_data_info1");
      var all_data_info2 = document.getElementById("all_data_info2");
      var all_data_div1 = document.getElementById("all_data_div1");
      var all_data_div2 = document.getElementById("all_data_div2"); 
      var all_data_table = document.getElementById("all_data_table");
      var local_csv_elem = document.getElementById("local_csv");
      var shipper_csv_elem = document.getElementById("shipper_csv");
      var local_csv_elem2 = document.getElementById("local_csv2");
      var shipper_csv_elem2 = document.getElementById("shipper_csv2");

      var all_data_tbody = document.getElementById("tbody_data_table");
      var all_data_thead = document.getElementById("thead_data_table");
      var all_data_tfoot = document.getElementById("all_data_table_tfoot");
      var doorhanger_tbody = document.getElementById("tbody_doorhanger_table");
      var doorhanger_thead = document.getElementById("thead_doorhanger_table");
      var doorhanger_tfoot = document.getElementById("doorhanger_table_tfoot");
      var giftshipper_thead = document.getElementById("thead_gift_shipper");
      var giftshipper_tbody = document.getElementById("tbody_gift_shipper");
      var giftshipper_tfoot = document.getElementById("gift_shipper_table_tfoot");

      all_data_tbody.innerHTML = all_data_thead.innerHTML = all_data_tfoot.innerHTML = "";
      doorhanger_tbody.innerHTML = doorhanger_thead.innerHTML = doorhanger_tfoot.innerHTML = "";
      giftshipper_thead.innerHTML = giftshipper_tbody.innerHTML = giftshipper_tfoot.innerHTML = "";

      var doorhanger_info = document.getElementById("doorhanger_info");
      var doorhanger_table = document.getElementById("doorhanger_table");
      var doorhanger_csv = document.getElementById("doorhanger_csv");
      var doorhanger_csv2 = document.getElementById("doorhanger_csv2");
      var doorhanger_div = document.getElementById("doorhanger_div");
      var doorhanger_main_div = document.getElementById("doorhanger_orders");

      var totals = document.getElementById("totals");
      var my_orders = document.getElementById("my_orders");
      var gift_shipper_table = document.getElementById("gift_shipper_table");
      var local_orders_div = document.getElementById("local_orders");
      var gift_shipper_orders_div = document.getElementById("gift_shipper_orders");
      var popup_elem = document.getElementById("popup_content");
      var column_toggle_checkbox = document.getElementById("column_toggle");
      var doorhangercolumn_toggle_checkbox = document.getElementById("doorhangercolumn_toggle");

      var name = "";
      scoutname == "Other" ? name = other_name : name = scoutname;
      var wreath_orders = JSON.parse(localStorage.getItem('cached_orders')) || [];
      var doorhanger_local_orders = JSON.parse(localStorage.getItem('doorhanger_orders')) || [];
      var gift_shipper_orders = JSON.parse(localStorage.getItem('cached_gift_shipper')) || [];
      var all_data_orders = JSON.parse(localStorage.getItem('all_data_orders')) || [];
      //wreath_orders.length == 0 ? render_orders("server") : null;
      var table_head = "";
      var doorhanger_table_head = "";
      var row_note = "";
      var table_line = "", table_row = "", order_divs_line = "";
      var doorhanger_table_line = "", doorhanger_table_row = "", doorhanger_order_divs_line = "";
      var giftshipper_total_row = "";
      var gift_shipper_total = 0;
      var local_orders_total = 0;
      var doorhanger_orders_total = 0;
      var all_totals = 0;
      var item_total = {};
      var doorhanger_item_total = {};
      var count = 0;
      var count2 = 0;
      var scout_donations_total = 0;
      var online_donations_total = 0;
      var door_hanger_total = 0;
      var td_count = 0;
      var td_count2 = 0;
      var scout_webform_count = {};
      var scout_doorhanger_count = {};
      var scout_giftshipper_count = {};
      var ignore_columns = [];
      scout_webform_count[name] = 0;
      scout_doorhanger_count[name] = 0;
      scout_giftshipper_count[name] = 0;

      var collected_amount = "";
      var remaining_amount = "";
      var collected_amount_text = "";
      var remaining_amount_text = "";

      //the following is looking through the 'All orders' tab in the tracking Sheet
      //first find which columns have collected and remaining
      all_data_orders.forEach((data_row, index) => {
        if (index == 0) {
          data_row.forEach((data_cell, index2) => {
            if (data_cell.toLowerCase().includes("collected")) {
              collected_amount_column = index2; // Set the index if found
            }
            if (data_cell.toLowerCase().includes("remaining")) {
              remaining_to_collect_column = index2; // Set the index if found
            }
          });
        }
      });

      //now when the scoutname matches get the collected and remaining amounts
      all_data_orders.forEach((data_row, index) => {
        if (data_row[1] == scoutname){
          collected_amount_column != 0 ? collected_amount = data_row[collected_amount_column] || "$0" : collected_amount = "";
          remaining_to_collect_column != 0 ? remaining_amount = data_row[remaining_to_collect_column] || "$0" : remaining_amount = "";
        }
      });

      //the following is the text of what to insert in My Orders
      collected_amount == "$0" ? null : collected_amount_text = `He turned in ${collected_amount}`;
      remaining_amount == "$0" ? remaining_amount_text = "." : remaining_amount_text = ` and has ${remaining_amount} remaining to turn in.`;
      remaining_amount == "$0" && collected_amount == "$0" ? remaining_amount_text = "" : null;
      remaining_amount == "" && collected_amount == "" ? (collected_amount_text= "", remaining_amount_text = "") : null;

      local_orders = JSON.parse(localStorage.getItem('cached_orders'));
      my_orders.style.display = "";

      var table_header = `
          <tr>hhhh</tr>
        `;
      var table_inner = `
        <tr>tttt</tr>
      `;

      var doorhanger_table_header = `
          <tr>hhhh</tr>
        `;

      var doorhanger_table_inner = `
        <tr>tttt</tr>
      `;

      var giftshipper_table_inner = `
        <tr>tttt</tr>
      `;

      //Handle Webform orders
      var order_divs = `<div class=''>dddd</div>`;
      all_data_div1.innerHTML = "";
      all_data_div2.innerHTML = "";

      //the following removes empty columns
      //first look for empties in the first row
      wreath_orders[0].forEach((item, i) => {
        item == "" ? ignore_columns.push(i) : null;
      });

      //then iterate through each row and remove the matching empty columns
      wreath_orders.forEach((order_row) => {
        ignore_columns.sort((a, b) => b - a);
        ignore_columns.forEach((index) => {
          order_row.splice(index, 1);
        });
      });

      ignore_columns = [];

      //fill each gap in the array (empty slots) with a zero
      wreath_orders.forEach((item, i) => {
        for (let i=0; i<wreath_orders[0].length; i++){
          item[i] == null || item[i] == "" ? item[i] = "0" : null;
          item[3] == "0" ? item[3] = "-" : null;
        }
      });

      wreath_orders[0].forEach((item, i) => {
        if (i == 1 || i == 3) return; //don't show scoutname or note in the table
        table_head += "<th class='column" + i + "'>" + item + "</th>";
      });

      all_data_thead.innerHTML = table_header.replace(/hhhh/g, table_head);

      wreath_orders.forEach((item, i) => {
       if (item[1] == name) {
        scout_webform_count[name]++;
         local_orders_total += Number(item[4].split("$")[1]);
         table_line = "";
         row_note = "";
         item[3] != "-"  ? row_note = "Order Note: " + item[3].replace(/[^a-zA-Z0-9@,\s\$\-\+\?\/\.\!]/g, "") + "<br>" : row_note = "";
         //order_divs_line is for smaller screens
         order_divs_line += "<div class='order_divs'>" + "Timestamp: " + item[0] + "<br>" + "<div>Customer: "
            + item[2] + "</div><br>" + "Total: " + item[4] + "<br>" + row_note;
        
         if (item[3] == "Wreath Sale Donation"){
          online_donations_total += Number(item[4].split("$")[1]);
         }
         else if (item[3] == "Door Hanger Order"){
          door_hanger_total += Number(item[4].split("$")[1]);
         }
         else {
          item[16] != "0" ? scout_donations_total += Number(item[16].split("$")[1]) : null;
         }

         item.forEach((item, i) => {
           td_count++;
           i == 3 && item != "0" ? row_note = item : null;
           i == 0 ? item = item.replace(/,/, ",<br>") : null;
           if (i == 1 || i == 3) return;
            if (row_note != "" && i == 2){
              table_line += "<td class='table_cell_note table_item_left' title='" + row_note.split('<br>')[0] 
                + "' onclick='note_popup(" + JSON.stringify(row_note) + ")'>" + item + "<div class='comment_div'></div></td>"; 
            }
            else if (i == 2){
              table_line += "<td class='table_item_left'>" + item.replace("<br>", " ") + "</td>"; 
            }
            else if (i == 0){
              table_line += "<td class='table_timestamp'>" + item + "</td>"; 
            }
            else {
              table_line += "<td id='" + td_count + "_column" + i + "' class='column" + i + "' onmouseover=td_mouseover(this) onmouseout=td_mouseout(this)>" + item + "</td>";
            }
          if (i >= 5) {
            item = item.toString().replace(/\$/g, '');
            item_total[i] ? item_total[i] += Number(item) : item_total[i] = Number(item);
          }

         if (wreath_orders[0][i] != "Donation"){
          i > 3 && item > "0" ? order_divs_line += "Item: " + wreath_orders[0][i] + " / " + "Qty: " + item + "<br>" : null;
         }
         else {
          i > 3 && item > "0" ? order_divs_line += "Item: " + "Donation" + " / " + "Amount: $" + item + "<br>" : null;
         }
         });
         table_row += table_inner.replace(/tttt/g, table_line);
         order_divs_line += "</div>";
       }
       row_note = "";
     });
     table_line = `<td>${scout_webform_count[name]} orders</td><td class='totals_class'><strong>TOTALS</strong></td><td class='totals_class'><strong>$${local_orders_total} </strong></td>`;
     for (const property in item_total) {
      count++;
      if (count == Object.keys(item_total).length) {
        table_line += "<td class='totals_class column" + property + "'> <strong>$" + item_total[property] + "</strong> </td>";
        if (column_toggle_checkbox.checked) {
          item_total[property] == 0 ? [...document.styleSheets[0].cssRules].find(x=> x.selectorText=='.column'+property)
          .style.display='none': null;
        }

      }
      else {
        table_line += "<td class='totals_class column" + property + "'> <strong>" + item_total[property] + "</strong> </td>";
        if (column_toggle_checkbox.checked) {
          item_total[property] == 0 ? [...document.styleSheets[0].cssRules].find(x=> x.selectorText=='.column'+property)
          .style.display='none': null;
        }


      }
     }
     all_data_tfoot.innerHTML = table_inner.replace(/tttt/g, table_line);


    //build the CSV data
     csvStr_local = "";
     wreath_orders.forEach((item, i) => {
      if (item[1] == "Name" || item[1] == name) {
        csvStr_local += '"' + item.map(item1 => item1.toString().replace(/<.*?[>]/g,'').replace(/[#]/g, "")).join('","') + '"\n';
      }
     });

      if (local_orders_total == 0 && name != "") {
        all_data_info1.innerHTML = "**** No webform order data for " + name;
        document.getElementById("tbody_data_table").innerHTML = "";
        all_data_div1.innerHTML = "";
        local_orders_div.style.display = "none";
      }
      else {
        all_data_info1.innerHTML = "";
        local_orders_div.style.display = "";
      }

      name == "" ? document.getElementById("tbody_data_table").innerHTML = "" : null;
      all_data_div1.insertAdjacentHTML('beforeend', order_divs.replace(/dddd/g, order_divs_line));

      document.getElementById("tbody_data_table").insertAdjacentHTML('beforeend', table_row);
      localStorage.getItem('cached_timestamp') ? cached_timestamp.innerHTML = "Last refresh from server: " + 
        localStorage.getItem('cached_timestamp')
            : null;

      //Handle Doorhanger Orders

      var doorhanger_order_divs = `<div class=''>dddd</div>`;
      doorhanger_div.innerHTML = "";

      //the following removes empty columns
      //first look for empties in the first row
      doorhanger_local_orders[0].forEach((item, i) => {
        item == "" ? ignore_columns.push(i) : null;
      });

      //then iterate through each row and remove the matching empty columns
      doorhanger_local_orders.forEach((order_row) => {
        ignore_columns.sort((a, b) => b - a);
        ignore_columns.forEach((index) => {
          order_row.splice(index, 1);
        });
      });

      ignore_columns = [];

      //fill each gap in the array (empty slots) with a zero
      doorhanger_local_orders.forEach((item, i) => {
        for (let i=0; i<doorhanger_local_orders[0].length; i++){
          item[i] == null || item[i] == "" ? item[i] = "0" : null;
          item[3] == "0" ? item[3] = "-" : null;
        }
      });

      doorhanger_local_orders[0].forEach((item, i) => {
        if (i == 1 || i == 3) return; //don't show scoutname or note in the table
        doorhanger_table_head += "<th class='doorhangercolumn" + i + "'>" + item + "</th>";
      });

      doorhanger_thead.innerHTML = doorhanger_table_header.replace(/hhhh/g, doorhanger_table_head);

      doorhanger_local_orders.forEach((item, i) => {
       if (item[1] == name) {
        scout_doorhanger_count[name]++;
         doorhanger_orders_total += Number(item[4].split("$")[1]);
         doorhanger_table_line = "";
         row_note = "";
         item[3] != "-"  ? row_note = "Order Note: " + item[3].replace(/[^a-zA-Z0-9@,\s\$\-\+\?\/\.\!]/g, "") + "<br>" : row_note = "";
         //doorhanger_order_divs_line is for smaller screens
         doorhanger_order_divs_line += "<div class='doorhanger_order_divs'>" + "Timestamp: " + item[0] + "<br>" + "<div>Customer: "
            + item[2] + "</div><br>" + "Total: " + item[4] + "<br>" + row_note;
        
         if (item[3] == "Wreath Sale Donation"){
          online_donations_total += Number(item[4].split("$")[1]);
         }
         else if (item[3] == "Door Hanger Order"){
          door_hanger_total += Number(item[4].split("$")[1]);
         }
         else {
          item[16] != "0" ? scout_donations_total += Number(item[16].split("$")[1]) : null;
         }

         item.forEach((item, i) => {
           td_count2++;
           i == 3 && item != "0" ? row_note = item : null;
           i == 0 ? item = item.replace(/,/, ",<br>") : null;
           if (i == 1 || i == 3) return;
            if (row_note == "Order Note: Wreath Sale Donation<br>" && i == 2){
              doorhanger_table_line += "<td class='table_cell_note table_item_left' title='" + row_note.split('<br>')[0] 
                + "' onclick='note_popup(" + JSON.stringify(row_note) + ")'>" + item + "<div class='comment_div'></div></td>"; 
            }
            else if (i == 2){
              doorhanger_table_line += "<td class='table_item_left'>" + item + "</td>"; 
            }
            else if (i == 0){
              doorhanger_table_line += "<td class='table_timestamp'>" + item + "</td>"; 
            }
            else {
              doorhanger_table_line += "<td id='" + td_count2 + "_doorhangercolumn" + i + "' class='doorhangercolumn" + i + "' onmouseover=td_mouseover(this) onmouseout=td_mouseout(this)>" + item + "</td>";
            }
          if (i >= 5) {
            item = item.toString().replace(/\$/g, '');
            doorhanger_item_total[i] ? doorhanger_item_total[i] += Number(item) : doorhanger_item_total[i] = Number(item);
          }

         if (doorhanger_local_orders[0][i] != "Donation"){
          i > 3 && item > "0" ? doorhanger_order_divs_line += "Item: " + doorhanger_local_orders[0][i] + " / " + "Qty: " + item + "<br>" : null;
         }
         else {
          i > 3 && item > "0" ? doorhanger_order_divs_line += "Item: " + "Donation" + " / " + "Amount: $" + item + "<br>" : null;
         }
         });
         doorhanger_table_row += table_inner.replace(/tttt/g, doorhanger_table_line);
         doorhanger_order_divs_line += "</div>";
       }
       row_note = "";
     });

     doorhanger_table_line = `<td>${scout_doorhanger_count[name]} orders</td><td class='totals_class'><strong>TOTALS</strong></td><td class='totals_class'><strong>$${doorhanger_orders_total} </strong></td>`;
     for (const property in doorhanger_item_total) {
      count2++;
      if (count2 == Object.keys(doorhanger_item_total).length) {
        doorhanger_table_line += "<td class='totals_class doorhangercolumn" + property + "'> <strong>$" + doorhanger_item_total[property] + "</strong> </td>";
        if (doorhangercolumn_toggle_checkbox.checked) {
          doorhanger_item_total[property] == 0 ? [...document.styleSheets[0].cssRules].find(x=> x.selectorText=='.doorhangercolumn'+property)
          .style.display='none': null;
        }

      }
      else {
        doorhanger_table_line += "<td class='totals_class doorhangercolumn" + property + "'> <strong>" + doorhanger_item_total[property] + "</strong> </td>";
        if (doorhangercolumn_toggle_checkbox.checked) {
          doorhanger_item_total[property] == 0 ? [...document.styleSheets[0].cssRules].find(x=> x.selectorText=='.doorhangercolumn'+property)
          .style.display='none': null;
        }


      }
     }
     doorhanger_tfoot.innerHTML = table_inner.replace(/tttt/g, doorhanger_table_line);


    //build the CSV data
     doorhanger_csvStr = "";
     doorhanger_local_orders.forEach((item, i) => {
      if (item[1] == "Name" || item[1] == name) {
        doorhanger_csvStr += '"' + item.map(item1 => item1.toString().replace(/<.*?[>]/g,'').replace(/[#]/g, "")).join('","') + '"\n';
      }
     });

      if (doorhanger_orders_total == 0 && name != "") {
        doorhanger_info.innerHTML = "**** No doorhanger order data for " + name;
        document.getElementById("tbody_doorhanger_table").innerHTML = "";
        doorhanger_div.innerHTML = "";
        doorhanger_main_div.style.display = "none";
      }
      else {
        doorhanger_info.innerHTML = "";
        doorhanger_main_div.style.display = "";
      }

      name == "" ? document.getElementById("tbody_doorhanger_table").innerHTML = "" : null;
      doorhanger_div.insertAdjacentHTML('beforeend', doorhanger_order_divs.replace(/dddd/g, doorhanger_order_divs_line));

      document.getElementById("tbody_doorhanger_table").insertAdjacentHTML('beforeend', doorhanger_table_row);


      //Handle Gift Shipper Orders
      table_line = "", table_row = "", order_divs_line = "", table_head = "", div_text = "";
      td_count = 0;
      td_count2 = 0;
      
      if (gift_shipper_orders){
        var table_column_names = ["Timestamp", "Buyer", "Recipient", "Wreath", "qty", "Cost", "Msg"];
        table_column_names.forEach((item, i) => {
          table_head += "<th>" + item + "</th>";
        });
      }
      if (name == "") {
        document.getElementById("tbody_gift_shipper").innerHTML = ""; 
        return;
      }
      else {
        giftshipper_thead.innerHTML = table_header.replace(/hhhh/g, table_head);
      }
      
      gift_shipper_orders.slice(1).forEach((item, i) => {
        var order_timestamp = item[0];
        var scout_credit = item[1];
        var buyer = item[2];
        var recipient = item[5] + ": " + item[6] + ", " + item[7] + ", " + item[8] + item[9];
        var wreath_item = item[10];
        var qty = item[11];
        var price = item[13];
        var msg = item[14];
        var div_text = "";
        var td_map = [order_timestamp, buyer, recipient, wreath_item, qty, price, msg];
        name == scout_credit ? gift_shipper_total += Number(qty) * Number(price.split("$")[1]) : null;
        if (item[1] == name) {
          scout_giftshipper_count[name]++;
          td_count++;
          td_map.forEach((item, i) => {
            table_line += "<td id='" + (td_count+3000) + "_column" + (i+100) + "' class='column" + (i+100) + "'>" + item + "</td>";

          });
          div_text += "<div class='order_divs'>" + "Timestamp: " + order_timestamp + "<br>" + "Buyer: " + buyer + "<br>" + "Recipient: "
              + recipient + "<br>" + "Item: " + wreath_item + " / " + "Qty: " + qty + "<br>" + "Price: " + price + "<br>"
              + "Gift Msg: " + msg;
          
            document.getElementById("tbody_gift_shipper").insertAdjacentHTML('beforeend', table_inner.replace(/tttt/g, table_line));
            all_data_div2.insertAdjacentHTML('beforeend', div_text);
        }

        //giftshipper_tfoot
        //giftshipper_total_row
        //gift_shipper_total
        //giftshipper_table_inner

        giftshipper_tfoot.innerHTML = `<td>${scout_giftshipper_count[name]} orders</td><td></td><td></td><td class='totals_class'><strong>TOTAL</strong></td><td></td>
          <td class='totals_class'><strong>$${round(gift_shipper_total, 2)}</strong></td><td></td>`;

        table_line = "";
        div_text = "";
      });

    //build the CSV data
      csvStr_ship = "";
      gift_shipper_orders.forEach((item, i) => {
      if (item[1] == "Scout/Org" || item[1] == name) {
        csvStr_ship += '"' + item.map(item1 => item1.replace('#','num')).map(item1 => item1.replace(/[\r\n]+/g,' ')).join('","') + '"\n';
      }
     });


      if (gift_shipper_total == 0 && name != "") {
        all_data_info2.innerHTML = "**** No Gift Shipper order data for " + name;
        document.getElementById("tbody_gift_shipper").innerHTML = "";
        all_data_div2.innerHTML = "";
        gift_shipper_orders_div.style.display = "none";
      }
      else {
        all_data_info2.innerHTML = "";
        gift_shipper_orders_div.style.display = "";
      }

      /*
      	totals.innerHTML = "Below are the orders for <strong>" + name + "</strong><br>" + "Grand Total: " + "$" + 
        numberWithCommas((local_orders_total + gift_shipper_total))
          + "<ul class='order_totals_ul'>"
          + "<li>" + "Gift Shipper: $" + numberWithCommas(round(gift_shipper_total, 2)) + "</li>"
          + "<li>" + "Local orders and Donations: $"  + numberWithCommas(local_orders_total) + "</li>"
          + "<ul>"
              + "<li>" + "Door to door orders: $" + numberWithCommas((local_orders_total - door_hanger_total - (scout_donations_total + online_donations_total))) + "</li>"
              + "<li>" + "Door Hanger: $" + numberWithCommas(door_hanger_total) + "</li>"
            + "</ul>"
            + "<ul>"
              + "<li>" + "Donations: $" + numberWithCommas((scout_donations_total + online_donations_total)) + "</li>"
              + "<ul>"
                + "<li>" + "Scout collected: $" + numberWithCommas(scout_donations_total) + "</li>"
                + "<li>" + "Via PayPal: $" + numberWithCommas(online_donations_total) + "</li>"
              + "</ul>"
            + "</ul>"
          + "</ul>"
          + name.split(" ")[0] + " should have $" + numberWithCommas(((local_orders_total - door_hanger_total - (scout_donations_total + online_donations_total)) 
            + scout_donations_total))
            + " from customers to turn in " + " ($" + numberWithCommas((local_orders_total - door_hanger_total - (scout_donations_total + online_donations_total)))
              + " + $" + numberWithCommas(scout_donations_total) + " in donations)"; 
        */

        // <li>Local orders and Donations: $${numberWithCommas(local_orders_total)}</li>


      totals.innerHTML = `
        Orders for <strong>${name}</strong><br>
        Grand Total: $${numberWithCommas(local_orders_total + gift_shipper_total + door_hanger_total)}
        <ul class='order_totals_ul'>
          <li>Webform: $${numberWithCommas(local_orders_total)}</li>
          <li>Doorhanger: $${numberWithCommas(doorhanger_orders_total)}</li>
          <li>Donations: $${numberWithCommas(scout_donations_total + online_donations_total)}</li>
            <ul>
              <li>Scout collected: $${numberWithCommas(scout_donations_total)}</li>
              <li>From Doorhanger: $${numberWithCommas(online_donations_total)}</li>
            </ul>
          <li>Gift Shipper: $${numberWithCommas(round(gift_shipper_total, 2))}</li>
        </ul>
        ${name.split(" ")[0]} should have <b>$${numberWithCommas(local_orders_total)}</b> from customers. ${collected_amount_text}${remaining_amount_text} 
      `;

      
      local_csv_elem.href = 'data:text/csv;charset=utf-8,' + encodeURI(csvStr_local);
      local_csv_elem.target = "_blank";
      local_csv_elem.download = name+"_local_orders.csv";

      doorhanger_csv.href = 'data:text/csv;charset=utf-8,' + encodeURI(doorhanger_csvStr);
      doorhanger_csv.target = "_blank";
      doorhanger_csv.download = name+"_local_orders.csv";

      shipper_csv_elem.href = 'data:text/csv;charset=utf-8,' + encodeURI(csvStr_ship);
      shipper_csv_elem.target = "_blank";
      shipper_csv_elem.download = name+"_gift_shipper_orders.csv";

      local_csv_elem2.href = 'data:text/csv;charset=utf-8,' + encodeURI(csvStr_local);
      local_csv_elem2.target = "_blank";
      local_csv_elem2.download = name+"_local_orders.csv";

      doorhanger_csv2.href = 'data:text/csv;charset=utf-8,' + encodeURI(doorhanger_csvStr);
      doorhanger_csv2.target = "_blank";
      doorhanger_csv2.download = name+"_local_orders.csv";

      shipper_csv_elem2.href = 'data:text/csv;charset=utf-8,' + encodeURI(csvStr_ship);
      shipper_csv_elem2.target = "_blank";
      shipper_csv_elem2.download = name+"_gift_shipper_orders.csv";

      table_paging("init");
    }
    
    function td_mouseover(elem){
      var column_name = elem.id.split("_")[1];
      Number(elem.id.split("_")[0]) < 3000 ?
      [...document.styleSheets[0].cssRules].find(x=> x.selectorText=="."+column_name)
          .style.background='#ddd': null;
      
      //Number(elem.id.split("_")[0]) < 1000 ? elem.style.background="orange" : null;
      //elem.style.background="orange";
    }

    function td_mouseout(elem){
      var column_name = elem.id.split("_")[1];
      [...document.styleSheets[0].cssRules].find(x=> x.selectorText=="."+column_name)
      .style.background='';
      elem.style.background="";

    }
  
    function checkbox_toggle(checkbox){
      //var column_toggle_checkbox = document.getElementById("column_toggle");
      var column_id = checkbox.id.split("_")[0];
      if (checkbox.checked) {
        render_orders("cached");
      }
      else {
        reset_columns([column_id]);
      }
    }
    
    function reset_columns(column_id){
      // Loop through all stylesheets in the document
      for (let sheet of document.styleSheets) {
        try {
          // Loop through all CSS rules in the current stylesheet
          for (let rule of sheet.cssRules || sheet.rules) {
            // Check if the selector starts with ".column"
            column_id.forEach((column_item) => {
              if (rule.selectorText && rule.selectorText.startsWith("." + column_item)) {
                  // Modify the CSS property
                  rule.style.display = "";
              };
            });
        }
        } catch (e) {
        // Some stylesheets (like cross-origin) might throw an error
        console.warn("Could not access stylesheet:", e);
        }
      }
    }

    function table_paging(selector, table_id){
      var MyDataTab = document.getElementById("my_orders_section");
      if (selector !== "new_page_len") {
        var listoftables = MyDataTab.querySelectorAll("table");
      }
      else {
        var listoftables = [document.getElementById(table_id)];

      }
      var MyPageCounter = "";
      var page_len_element = document.getElementById(table_id + "_table_paging_select");
      var page_len = page_len_element ? Number(page_len_element.value) : 10;

      if (selector == "init" || selector =="new_page_len"){
        listoftables.forEach((element) => {
          var backbutton = document.getElementById(`${element.id}_back`) || null;
          var forwardbutton = document.getElementById(`${element.id}_forward`) || null;
          var page_number = document.getElementById(`${element.id}_number`) || null;
          var pager = document.getElementById(`${element.id}__pager`) || null;
          var tfoot = document.getElementById(`${element.id}_tfoot`);
          var tcaption = document.getElementById(`${element.id}_caption`);
          [...document.styleSheets[0].cssRules].find(x=> x.selectorText=='.paging_div').style.top='-5px';
          //pager_html[element.id] !== "" ? pager.innerHTML = pager_html[element.id] : null;
          table_index[element.id] = 1;
          var listofRows = element.querySelectorAll("tbody tr");
          table_len[element.id] = listofRows.length;
          page_number ? (page_number.innerText = "1", backbutton.classList.add("disabled_arrow")) : null;
          if (pager) {
            pager.remove();
            document.getElementById(`${element.id}_tfoot_tr`) ? document.getElementById(`${element.id}_tfoot_tr`).remove() : null;
          }
          if (listofRows.length > page_len || selector == "new_page_len"){
            var new_caption_tr = `
              <div class="paging_div" id="${element.id}__pager">
                <div id="${element.id}_back" onclick="table_paging('back', '${element.id}')" class="table_paging_button disabled_arrow">&laquo;</div>
                Page
                <div id="${element.id}_number">1</div>
                <div id="${element.id}_forward" onclick="table_paging('forward', '${element.id}')" class="table_paging_button">&raquo;</div>
              </div>
            `;

            var new_tfoot_tr = `
              <tr id='${element.id}_tfoot_tr' class='tfoot_wide_tr'>
                <td colspan='42' class='table_tfoot'>
                  <div id='${element.id}_tfoot_div1' class='tfoot_div1'>
                    <div class='paging_div2' id='${element.id}__pager2'>
                      <div id='${element.id}_back2' onclick="table_paging('back', '${element.id}')" class='table_paging_button disabled_arrow'>&laquo;</div>
                      Page
                      <div id='${element.id}_number2'>1</div>
                      <div id='${element.id}_forward2' onclick="table_paging('forward', '${element.id}')" class='table_paging_button'>&raquo;</div>
                    </div>
                    <div class='paging_div3'>
                      <select id='${element.id}_table_paging_select' onchange='table_paging_select("${element.id}", this.value, event)'>
                        <option value='5'>5 rows/page ↯</option>
                        <option selected value='10'>10 rows/page ↯</option>
                        <option value='20'>20 rows/page ↯</option>
                        <option value='25'>25 rows/page ↯</option>
                        <option value='all'>All rows/page ↯</option>
                      </select>
                    </div>
                  </div>
                </td>
              </tr>
            `;

            tfoot.insertAdjacentHTML("beforeend", new_tfoot_tr);
            tcaption.insertAdjacentHTML("beforeend", new_caption_tr);

            selector == "new_page_len" ? document.getElementById(`${element.id}_table_paging_select`).value = page_len.toString() : null;
            selector == "new_page_len" && page_len >= listofRows.length ? (document.getElementById(`${element.id}_forward2`).classList.add("disabled_arrow"),
              document.getElementById(`${element.id}_forward`).classList.add("disabled_arrow")) : null;

            pager ? pager.style.display = "" : null;
            if (forwardbutton){
              forwardbutton.classList.contains("disabled_arrow") ? forwardbutton.classList.remove("disabled_arrow") : null;
            }
            listofRows.forEach((tr_element, index) => {
              if (!(index >= 0 && index < page_len)) {
                tr_element.classList.add("hidden_row");
              }
              else {
                tr_element.classList.contains("hidden_row") ? tr_element.classList.remove("hidden_row") : null;
              }
            });
          }
          else {
            pager ? pager.style.display = "none" : null;
          }
        });
      }
      else if (selector == "forward"){
          MyPageCounter = document.getElementById(`${table_id}_number`);
          MyPageCounter2 = document.getElementById(`${table_id}_number2`);
          if (table_index[table_id] + page_len <= table_len[table_id]) {
            table_index[table_id] = table_index[table_id] + page_len;
            MyPageCounter.innerText = (Number(MyPageCounter.innerText) + 1).toString();
            MyPageCounter2.innerText = (Number(MyPageCounter2.innerText) + 1).toString();
            document.getElementById(`${table_id}_back`).classList.remove("disabled_arrow");
            document.getElementById(`${table_id}_back2`).classList.remove("disabled_arrow");
            (table_index[table_id] + page_len <= table_len[table_id]) ? null : document.getElementById(`${table_id}_forward`).classList.add("disabled_arrow");
            (table_index[table_id] + page_len <= table_len[table_id]) ? null : document.getElementById(`${table_id}_forward2`).classList.add("disabled_arrow");
          }

          var listofRows = document.getElementById(table_id).querySelectorAll("tbody tr");
          listofRows.forEach((tr_element, index) => {
            if ((index+1 >= table_index[table_id] && index+1 < table_index[table_id]+page_len)){
              tr_element.classList.contains("hidden_row") ? tr_element.classList.remove("hidden_row") : null;
            }
            else {
              tr_element.classList.contains("hidden_row") ? null : tr_element.classList.add("hidden_row");

            }
          });
        }
        else if (selector == "back"){
          MyPageCounter = document.getElementById(`${table_id}_number`);
          MyPageCounter2 = document.getElementById(`${table_id}_number2`);
          if (table_index[table_id] > 1) {
            table_index[table_id] = table_index[table_id] - page_len;
            MyPageCounter.innerText = (Number(MyPageCounter.innerText) - 1).toString();
            MyPageCounter2.innerText = (Number(MyPageCounter2.innerText) - 1).toString();
            document.getElementById(`${table_id}_forward`).classList.remove("disabled_arrow");
            document.getElementById(`${table_id}_forward2`).classList.remove("disabled_arrow");
            MyPageCounter.innerText == "1" ? document.getElementById(`${table_id}_back`).classList.add("disabled_arrow") : null;
            MyPageCounter.innerText == "1" ? document.getElementById(`${table_id}_back2`).classList.add("disabled_arrow") : null;
          }
          var listofRows = document.getElementById(table_id).querySelectorAll("tbody tr");
          listofRows.forEach((tr_element, index) => {
            if ((index+1 >= table_index[table_id] && index+1 < table_index[table_id]+page_len)){
             tr_element.classList.contains("hidden_row") ? tr_element.classList.remove("hidden_row") : null;  
            }
            else {
              tr_element.classList.contains("hidden_row") ? null : tr_element.classList.add("hidden_row");
            }
          });
        }

        else if (selector == "all"){
          var listofRows = document.getElementById(table_id).querySelectorAll("tbody tr");
          var pager = document.getElementById(`${table_id}__pager`) || null;
          var footer = document.getElementById(`${table_id}__pager2`) || null;
          var page_number = document.getElementById(`${table_id}_number`);
          var tfoot_tr = document.getElementById(`${table_id}_tfoot_tr`);
          //tfoot_tr.style.display = "none";
          page_number.innerText = "1";
          pager_html[table_id] = pager.innerHTML;
          pager.innerHTML = "All Rows";
          footer.innerHTML = "All Rows";
          [...document.styleSheets[0].cssRules].find(x=> x.selectorText=='.paging_div').style.top='0';
          listofRows.forEach((tr_element, index) => {
            tr_element.classList.contains("hidden_row") ? tr_element.classList.remove("hidden_row") : null;  
          });
        }

        //the following scrolls the window to the top of the table
        const tableElement = document.getElementById(table_id);
        if (tableElement) {
          const offset = 70;
          const topPosition = tableElement.getBoundingClientRect().top + window.scrollY - offset;

          // Use requestAnimationFrame to ensure smooth scrolling
          requestAnimationFrame(() => {
            window.scrollTo({ top: topPosition, behavior: 'smooth' });
          });
        }
      }

    function table_paging_select(table_id, select_value, event){
      event.stopPropagation();
    
      select_value == "all" ? table_paging(select_value, table_id) : table_paging("new_page_len", table_id);

    }

    function numberWithCommas(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }


    function note_popup(note_msg){
      var popup_elem = document.getElementById("popup_content");
      popup_elem.innerHTML = note_msg;
      toggle_modal();
    }

    function round(value, decimals) {
        return Number(Math.round(value+'e'+decimals)+'e-'+decimals);
      } 

    function phoneFormat(input) {//returns (###) ###-####
      input = input.replace(/\D/g,'');
      var size = input.length;
      if (size>0) {input="("+input}
      if (size>3) {input=input.slice(0,4)+") "+input.slice(4,11)}
      if (size>6) {input=input.slice(0,9)+"-" +input.slice(9)}
      return input;
    }

    function donation_amt(input) {//returns $nn
      input = input.replace(/\D/g,'');
      var size = input.length;
      if (size>0) {input="$"+input};
      return input;
    }

    function donation_amt_blur(elem){
      var wreath_index = document.getElementById("wreath_item_"+elem.id.split("_")[3]).value;
      var MMM = elem.id.split("_")[3];
      single_order[Number(MMM)] = [wreath_index, "1", elem.value.split("$")[1], local_catalog[wreath_index][1]];
      single_order_data();
      single_order_total();
    }
    
    function paid_button(){
      document.getElementById("cust_note").value = "Paid in full";
    }

    function geo_loc(){
      var input_elem = document.getElementById("cust_addr");
      var popup_elem = document.getElementById("popup_content");

      if(!navigator.geolocation) {
        //status.textContent = 'Geolocation is not supported by your browser';
        console.log("not supported by browser");
      }
      else {
        navigator.geolocation.getCurrentPosition(success, error);
      }

      function success(position){
        const latitude  = position.coords.latitude;
        const longitude = position.coords.longitude;
        input_elem.value = "GPS: " + latitude.toFixed(5) + ", " + longitude.toFixed(5);

      }

      function error(){
        popup_elem.innerHTML = "Geolocation is not supported by your browser!";
        toggle_modal();
      }

    }

    function getip() {
      return fetch("https://api64.ipify.org?format=json")
        .then(response => response.json())
        .then(data => data.ip);
    }

  </script>

  <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "4b15b6df96b74d90a7fcc047928772f4"}'></script><!-- End Cloudflare Web Analytics -->
</html>
